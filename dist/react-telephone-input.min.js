"use strict";function isNumberValid(e){var t=countryData.allCountries;return some(t,function(t){return startsWith(e,t.dialCode)||startsWith(t.dialCode,e)})}function findCountry(e){return"string"==typeof e&&2===e.length?findWhere(allCountries,{iso2:e}):e}var some=require("lodash/collection/some"),findWhere=require("lodash/collection/findWhere"),reduce=require("lodash/collection/reduce"),map=require("lodash/collection/map"),filter=require("lodash/collection/filter"),findIndex=require("lodash/array/findIndex"),first=require("lodash/array/first"),rest=require("lodash/array/rest"),debounce=require("lodash/function/debounce"),memoize=require("lodash/function/memoize"),trim=require("lodash/string/trim"),onClickOutside=require("react-onclickoutside"),startsWith=require("lodash/string/startsWith"),React=require("react"),classNames=require("classnames"),countryData=require("./country_data"),allCountries=countryData.allCountries,isModernBrowser;isModernBrowser="undefined"!=typeof document?Boolean(document.createElement("input").setSelectionRange):!0;var keys={UP:38,DOWN:40,RIGHT:39,LEFT:37,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,SPACE:32},ReactTelephoneInput=React.createClass({displayName:"ReactTelephoneInput",mixins:[onClickOutside],getInitialState:function(){var e=this.props.onlyCountries?map(this.props.onlyCountries,findCountry):allCountries,t=map(this.props.preferredCountries,findCountry),r=this.props.value||"",n=this.guessSelectedCountry(r.replace(/\D/g,""),e),s=findIndex(allCountries,n);this.formatNumber(r.replace(/\D/g,""),n?n.format:null);return{countries:e,preferredCountries:t,selectedCountry:n,highlightCountryIndex:s,formattedNumber:"",showDropDown:!1,queryString:"",freezeSelection:!1,debouncedQueryStingSearcher:debounce(this.searchCountry,100)}},propTypes:{value:React.PropTypes.string,autoFormat:React.PropTypes.bool,defaultCountry:React.PropTypes.string,onlyCountries:React.PropTypes.any,preferredCountries:React.PropTypes.any,onChange:React.PropTypes.func,onEnterKeyPress:React.PropTypes.func},getDefaultProps:function(){return{value:"",autoFormat:!0,onlyCountries:allCountries,defaultCountry:allCountries[0].iso2,isValid:isNumberValid,flagsImagePath:"flags.png",placeholder:"+1 (702) 123-4567",onEnterKeyPress:function(){}}},getNumber:function(){return"+"!==this.state.formattedNumber?this.state.formattedNumber:""},getValue:function(){return this.getNumber()},componentDidMount:function(){document.addEventListener("keydown",this.handleKeydown),"function"==typeof this.props.onChange&&this.props.onChange(this.state.formattedNumber)},componentWillUnmount:function(){document.removeEventListener("keydown",this.handleKeydown)},scrollTo:function(e,t){if(e){var r=this.refs.flagDropdownList;if(r){var n=r.offsetHeight,s=r.getBoundingClientRect(),o=s.top+document.body.scrollTop,i=o+n,a=e,l=a.getBoundingClientRect(),u=a.offsetHeight,h=l.top+document.body.scrollTop,c=h+u,d=h-o+r.scrollTop,f=n/2-u/2;if(o>h)t&&(d-=f),r.scrollTop=d;else if(c>i){t&&(d+=f);var p=n-u;r.scrollTop=d-p}}}},formatNumber:function(e,t){if(!e||0===e.length)return"+";if(e&&e.length<2||!t||!this.props.autoFormat)return"+"+e;var r=reduce(t,function(e,t){return 0===e.remainingText.length?e:"."!==t?{formattedText:e.formattedText+t,remainingText:e.remainingText}:{formattedText:e.formattedText+first(e.remainingText),remainingText:rest(e.remainingText)}},{formattedText:"",remainingText:e.split("")});return r.formattedText+r.remainingText.join("")},_cursorToEnd:function(){var e=this.refs.numberInput;if(e.focus(),isModernBrowser){var t=e.value.length;e.setSelectionRange(t,t)}},guessSelectedCountry:memoize(function(e,t){t=this.state&&this.state.countries||t;var r=findWhere(allCountries,{iso2:this.props.defaultCountry})||t[0];if(""===trim(e))return r;var n=reduce(t,function(t,r){if(startsWith(e,r.dialCode)){if(r.dialCode.length>t.dialCode.length)return r;if(r.dialCode.length===t.dialCode.length&&r.priority<t.priority)return r}return t},{dialCode:"",priority:10001},this);return n.name?n:r}),getElement:function(e){return this.refs["flag_no_"+e]},handleFlagDropdownClick:function(){var e=this;this.setState({showDropDown:!this.state.showDropDown,highlightCountry:findWhere(this.state.countries,this.state.selectedCountry),highlightCountryIndex:findIndex(this.state.countries,this.state.selectedCountry)},function(){e.state.showDropDown&&e.scrollTo(e.getElement(e.state.highlightCountryIndex+e.state.preferredCountries.length))})},handleInput:function(e){var t="+",r=this.state.selectedCountry,n=this.state.freezeSelection;if(e.target.value!==this.state.formattedNumber){if(e.preventDefault?e.preventDefault():e.returnValue=!1,e.target.value.length>0){var s=e.target.value.replace(/\D/g,"");(!this.state.freezeSelection||this.state.selectedCountry.dialCode.length>s.length)&&(r=this.guessSelectedCountry(s.substring(0,6)),n=!1),t=this.formatNumber(s,r.format)}var o=e.target.selectionStart,i=this.state.formattedNumber,a=t.length-i.length;this.setState({formattedNumber:t,freezeSelection:n,selectedCountry:r.dialCode.length>0?r:this.state.selectedCountry},function(){isModernBrowser&&(a>0&&(o-=a),o>0&&i.length>=t.length&&this.refs.numberInput.setSelectionRange(o,o)),this.props.onChange&&this.props.onChange(this.state.formattedNumber)})}},handleInputClick:function(){this.setState({showDropDown:!1})},handleClickOutside:function(){this.state.showDropDown&&this.setState({showDropDown:!1})},handleFlagItemClick:function(e){var t=this.state.selectedCountry,r=findWhere(this.state.countries,e);if(t.iso2!==r.iso2){var n=this.state.formattedNumber.replace(t.dialCode,r.dialCode),s=this.formatNumber(n.replace(/\D/g,""),r.format);this.setState({showDropDown:!1,selectedCountry:r,freezeSelection:!0,formattedNumber:s},function(){this.props.onChange&&this.props.onChange(s)})}},handleInputFocus:function(){console.log(this.refs.numberInput.value),("+"===this.refs.numberInput.value||""===this.refs.numberInput.value)&&this.setState({formattedNumber:"+"+this.state.selectedCountry.dialCode}),this.props.onFocus&&this.props.onFocus()},handleInputBlur:function(){this.props.onBlur&&this.props.onBlur()},_getHighlightCountryIndex:function(e){var t=this.state.highlightCountryIndex+e;return 0>t||t>=this.state.countries.length+this.state.preferredCountries.length?t-e:t},_searchCountry:memoize(function(e){if(!e||0===e.length)return null;var t=filter(this.state.countries,function(t){return startsWith(t.name.toLowerCase(),e.toLowerCase())},this);return t[0]}),searchCountry:function(){var e=this._searchCountry(this.state.queryString)||this.state.countries[0],t=findIndex(this.state.countries,e)+this.state.preferredCountries.length;this.scrollTo(this.getElement(t),!0),this.setState({queryString:"",highlightCountryIndex:t})},handleKeydown:function(e){function t(e){var t=this;this.setState({highlightCountryIndex:this._getHighlightCountryIndex(e)},function(){t.scrollTo(t.getElement(t.state.highlightCountryIndex),!0)})}if(this.state.showDropDown)switch(e.preventDefault?e.preventDefault():e.returnValue=!1,e.which){case keys.DOWN:t(1);break;case keys.UP:t(-1);break;case keys.ENTER:this.handleFlagItemClick(this.state.countries[this.state.highlightCountryIndex],e);break;case keys.ESC:break;default:(e.which>=keys.A&&e.which<=keys.Z||e.which===keys.SPACE)&&this.setState({queryString:this.state.queryString+String.fromCharCode(e.which)},this.state.debouncedQueryStingSearcher)}},handleInputKeyDown:function(e){e.which===keys.ENTER&&this.props.onEnterKeyPress(e)},getCountryDropDownList:function(){var e=this,t=this.state,r=t.preferredCountries,n=t.countries,s=map(r.concat(n),function(t,r){var n=classNames({country:!0,preferred:"us"===t.iso2||"gb"===t.iso2,active:"us"===t.iso2,highlight:e.state.highlightCountryIndex===r});return React.createElement("li",{ref:"flag_no_"+r,key:"flag_no_"+r,"data-flag-key":"flag_no_"+r,className:n,"data-dial-code":"1","data-country-code":t.iso2,onClick:e.handleFlagItemClick.bind(e,t)},React.createElement("div",{className:"flag "+t.iso2,style:e.getFlagStyle()}),React.createElement("span",{className:"country-name"},t.name),React.createElement("span",{className:"dial-code"},"+"+t.dialCode))});if(this.state.preferredCountries.length){var o=React.createElement("li",{key:"dashes",className:"divider"});s.splice(this.state.preferredCountries.length,0,o)}var i=classNames({"country-list":!0,hide:!this.state.showDropDown});return React.createElement("ul",{ref:"flagDropdownList",className:i},s)},getFlagStyle:function(){return{width:16,height:11,backgroundImage:"url("+this.props.flagsImagePath+")"}},render:function(){var e=classNames({arrow:!0,up:this.state.showDropDown}),t=classNames({"form-control":!0,"invalid-number":!this.props.isValid(this.state.formattedNumber.replace(/\D/g,""))}),r=classNames({"flag-dropdown":!0,"open-dropdown":this.state.showDropDown}),n="flag "+this.state.selectedCountry.iso2;return React.createElement("div",{className:"react-tel-input"},React.createElement("input",{onChange:this.handleInput,onClick:this.handleInputClick,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onKeyDown:this.handleInputKeyDown,value:this.state.formattedNumber,ref:"numberInput",type:"tel",className:t,placeholder:this.props.placeholder}),React.createElement("div",{ref:"flagDropDownButton",className:r,onKeyDown:this.handleKeydown},React.createElement("div",{ref:"selectedFlag",onClick:this.handleFlagDropdownClick,className:"selected-flag",title:this.state.selectedCountry.name+": + "+this.state.selectedCountry.dialCode},React.createElement("div",{className:n,style:this.getFlagStyle()},React.createElement("div",{className:e}))),this.state.showDropDown?this.getCountryDropDownList():""))}});module.exports=ReactTelephoneInput;
